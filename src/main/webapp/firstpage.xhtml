<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

<h:head>
   <title>Cadastro de Usuários</title>
</h:head>

<h:body>

   <ui:include src="menu.xhtml"/>  <!--include = vai acessar meu método que está no menu, para eu não precisar repetir código -->

   <h:form id="formPessoa" enctype="multipart/form-data" rendered="#{pessoaBean.permiteAcesso('ADMINISTRADOR')}"> <!-- aqui apenas o usuário de administrador vai ter acesso ao formulário-->

      <h:graphicImage height="150" width="280" library="imagens" name="avancard-logo.webp"/>

      <b:messages/>  <!-- adicionando a mensagem feita no meu pessoabean  -->

      <h:panelGrid columns="4"> <!-- panelGrid = serve para organizar  -->
         <f:facet name="header">
            <h:outputText value="Cadastro de Usuários"/>
         </f:facet> <!-- facet = serve para eu colocar meio que um título  -->

         <b:column>
            <h:outputLabel value="Id:"/>
            <b:inputText value="#{pessoaBean.pessoa.id}" readonly="true"/>
         </b:column>

         <b:column>
            <h:outputLabel value="Foto:"/>
            <h:inputFile id="foto" value="#{pessoaBean.arquivoFoto}"/> <!--inputFile = vai ser meu campo de upload de arquivo -->
         </b:column>

         <b:column>
         <h:outputText value="Nome:"/>
         <b:inputText value="#{pessoaBean.pessoa.nome}" valueChangeListener="#{pessoaBean.mudancaDeValor}" required="true" requiredMessage="Informe o nome do usuário"
                      pt:placeholder="Informe o nome do usuário" validatorMessage="Nome precisa ter no mínimo 3 letras"> <!--placeholder = deixa mensagem dentro do campo de texto -->
            <f:validateLength minimum="3" maximum="50"/>      <!--required = serve para informar que esse campo vai ser obrigatório ser preenchido -->
         </b:inputText>
         </b:column>

         <b:column>
            <h:outputLabel value="Sobrenome:"/>
            <b:inputText value="#{pessoaBean.pessoa.sobrenome}"/>
         </b:column>

         <b:column>
            <h:outputLabel value="Idade:"/>
            <b:inputText value="#{pessoaBean.pessoa.idade}"/>
         </b:column>

         <b:column>
            <h:outputLabel value="Cpf:"/>
            <b:inputText value="#{pessoaBean.pessoa.cpf}"/>
         </b:column>

         <b:column>
            <h:outputLabel value="Título Eleitoral"/>
            <b:inputText value="#{pessoaBean.pessoa.titEleitoral}"/>
         </b:column>

         <b:column>
         <h:outputLabel value="Sexo:"/>
         <b:selectOneMenu id="campoSexo" value="#{pessoaBean.pessoa.sexo}">  <!-- selectOneMenu = é aquele famoso combobox só que em jsf, mas seleciona apenas uma opção-->
            <f:selectItem itemValue="NAO" itemLabel="--Selecione--" noSelectionOption="true"/>
            <f:selectItem itemValue="M" itemLabel="Masculino"/>      <!-- selectItem = são os valores que irão dentro do selectOneMenu-->
            <f:selectItem itemValue="F" itemLabel="Feminino"/>             <!-- itemValue = é o que vai aparecer no banco de dados-->
         </b:selectOneMenu>                                                      <!-- itemLabel = é o que vai aparecer na tela para o usuário-->
         </b:column>

         <b:column>
         <h:outputLabel value="Nascimento:"/>
            <b:inputText value="#{pessoaBean.pessoa.dataNascimento}" converterMessage="Data de nascimento errada">
               <f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR" timeZone="GMT-04:00"/>
            </b:inputText>
         </b:column>

         <b:column>
         <h:outputLabel value="Frameworks:"/>
         <h:selectManyMenu id="campoFrameworks" style="height: 130px;" value="#{pessoaBean.pessoa.frameworks}">
            <f:selectItem itemValue="Hibernate"/>
            <f:selectItem itemValue="Spring MVC"/>
            <f:selectItem itemValue="JPA"/>
            <f:selectItem itemValue="JSF"/>
            <f:selectItem itemValue="Primefaces"/>
         </h:selectManyMenu>   <!-- selectManyMenu = serve para selecionar várias opções-->
         </b:column>

         <b:column>
            <h:outputLabel value="Ativo:"/>
            <h:selectBooleanCheckbox value="#{pessoaBean.pessoa.ativo}"/>
         </b:column>

         <b:column>
            <h:outputLabel value="Login:"/>
            <b:inputText value="#{pessoaBean.pessoa.login}"/>
         </b:column>

         <b:column>
            <h:outputLabel value="Senha:"/>
            <b:inputSecret value="#{pessoaBean.pessoa.senha}"/>
         </b:column>

         <b:column>
         <h:outputLabel value="Perfil:"/>
         <b:selectOneMenu id="perfil" value="#{pessoaBean.pessoa.perFilUser}" required="false">
            <f:selectItem itemLabel="--Selecione--" noSelectionOption="true"/>
            <f:selectItem itemValue="ADMINISTRADOR" itemLabel="Administrador"/>
            <f:selectItem itemValue="DESENVOLVEDOR" itemLabel="Desenvolvedor"/>
            <f:selectItem itemValue="ESTAGIARIO" itemLabel="Estagiario"/>
         </b:selectOneMenu>
         </b:column>

         <b:column>
         <h:outputLabel value="Programador:"/>
         <h:selectOneRadio value="#{pessoaBean.pessoa.nivelProgramador}" layout="pageDirection">  <!--layout="pageDirection" = serve para organizar o layoult oneRadio-->
            <f:selectItem itemValue="JUNIOR" itemLabel="Junior"/>   <!-- itemValue = é o que vai aparecer no banco de dados-->
            <f:selectItem itemValue="PLENO" itemLabel="Pleno"/>        <!-- itemLabel = é o que vai aparecer na tela para o usuário-->
            <f:selectItem itemValue="SENIOR" itemLabel="Sênior"/>
            <f:selectItem itemValue="FULLSTACK" itemLabel="FullStack"/>
         </h:selectOneRadio>
         </b:column>

         <b:column>
         <h:outputLabel value="Linguagens:"/>
         <h:selectManyCheckbox value="#{pessoaBean.pessoa.linguagens}">  <!--selectManyCheckbox = consigo selecionar várias linguagens com esse método  -->
            <f:selectItem itemValue="1" itemLabel="Java"/>
            <f:selectItem itemValue="2" itemLabel="PHP"/>
            <f:selectItem itemValue="3" itemLabel="Pyton"/>
            <f:selectItem itemValue="4" itemLabel="C#"/>
            <f:selectItem itemValue="5" itemLabel="Cobol"/>
         </h:selectManyCheckbox>
         </b:column>

         <b:column>
         <h:outputLabel value="Estados:"/>
         <b:selectOneMenu value="#{pessoaBean.pessoa.estados}" immediate="true" id="comboEstados" converter="estadoConverter"> <!--immediate = é usado quando se usa ajax para passar a requisição por "debaixo" de qualquer validação que ele tente fazer e chamar o método -->
            <f:selectItem itemLabel="--Selecione--" noSelectionOption="true"/>
            <f:selectItems value="#{pessoaBean.estados}"/>
            <f:ajax event="change" execute="@form" render="@form" listener="#{pessoaBean.carregarCidades}"/> <!--render = serve para recarregar o informado -->
         </b:selectOneMenu>
         </b:column>

         <b:column>
         <h:outputLabel value="Cidades:"/>
         <b:selectOneMenu value="#{pessoaBean.pessoa.cidades}" immediate="true" id="comboCidade" converter="cidadeConverter">
            <f:selectItem noSelectionOption="true" itemLabel="--Selecione--"/>
            <f:selectItems value="#{pessoaBean.cidades}"/>
         </b:selectOneMenu>
         </b:column>

         <b:column>
         <h:outputLabel value="CEP:"/>
         <b:inputText value="#{pessoaBean.pessoa.cep}" pt:placeholder="Informe um cep válido">      <!-- render = vai carregar o logradouro assim que eu colocar o cep-->
            <f:ajax event="blur" execute="@form" listener="#{pessoaBean.pesquisaCep}" render="@form"/>  <!-- event="blur" = no jsf significa perda de foco-->
         </b:inputText>
         </b:column>

         <b:column>
            <h:outputLabel value="Logradouro:"/>
            <b:inputText value="#{pessoaBean.pessoa.logradouro}" id="logradouro"/>
         </b:column>

         <b:column>
            <h:outputLabel value="Complemento:"/>
            <b:inputText value="#{pessoaBean.pessoa.complemento}" id="complemento"/>
         </b:column>

         <b:column>
            <h:outputLabel value="Bairro:"/>
            <b:inputText value="#{pessoaBean.pessoa.bairro}" id="bairro"/>
         </b:column>

         <b:column>
            <h:outputLabel value="Localidade:"/>
            <b:inputText value="#{pessoaBean.pessoa.localidade}" id="localidade"/>
         </b:column>

         <b:column>
            <h:outputLabel value="UF:"/>
            <b:inputText value="#{pessoaBean.pessoa.uf}" id="uf"/>
         </b:column>

         <b:column>
            <h:outputLabel value="Unidade:"/>
            <b:inputText value="#{pessoaBean.pessoa.unidade}" id="unidade"/>
         </b:column>

         <b:column>
            <h:outputLabel value="Ibge:"/>
            <b:inputText value="#{pessoaBean.pessoa.ibge}" id="ibge"/>
         </b:column>

         <b:column>
            <h:outputLabel value="Gia:"/>
            <b:inputText value="#{pessoaBean.pessoa.gia}" id="gia"/>
         </b:column>

         <h:outputLabel/>
         <h:panelGroup>
            <h:commandButton value="Novo" action="#{pessoaBean.novo}" image="resources/imagens/add-user.png" title="Novo" immediate="true"/>
            <h:commandButton value="Salvar" actionListener="#{pessoaBean.registraLog}" action="#{pessoaBean.salvar}" image="resources/imagens/icon-salvar.png" title="Salvar"/> <!--actionListener = vai redirecionar para fazer algo antes do salvar -->
            <h:commandButton value="Remove" action="#{pessoaBean.remove}" image="resources/imagens/icon-remover.png" title="Remover" rendered="#{pessoaBean.permiteAcesso('ADMINISTRADOR')}" immediate="true"/>
            <h:commandButton value="Limpar" action="#{pessoaBean.limpar}" image="resources/imagens/icon-limpar.png" title="Limpar" immediate="true"/>
         </h:panelGroup>

   </h:panelGrid>
   </h:form>

   <h:form id="formTable">                                                       <!--cellpadding = ajusta o tamanho da célula -->
      <b:dataTable value="#{pessoaBean.pessoasList}" var="pessoa" border="2" cellpadding="6">  <!-- dataTable = estou usando para organizar em forma de tabela -->
         <f:facet name="header"> <!-- facet = serve para eu colocar meio que um título  -->
            Lista de usuários cadastradas
         </f:facet>

         <h:column>
            <f:facet name="header">ID</f:facet>
            <h:outputText value="#{pessoa.id}"/>
         </h:column>

         <h:column>
            <f:facet name="header">Nome</f:facet>
            <h:outputText value="#{pessoa.nome}"/>
         </h:column>

         <h:column>
            <f:facet name="header">Sobrenome</f:facet>
            <h:outputText value="#{pessoa.sobrenome}"/>
         </h:column>

         <h:column>
            <f:facet name="header">Foto</f:facet>
            <h:commandLink actionListener="#{pessoaBean.download}" immediate="true">
               <h:graphicImage width="60" height="60" value="#{pessoa.fotoIconBase64}"/>
               <f:param name="fileDownloadId" value="#{pessoa.id}"/>
            </h:commandLink>
         </h:column>

         <h:column>
            <f:facet name="header">Editar</f:facet>
            <h:commandLink title="Editar" immediate="true" action="#{pessoaBean.editar}">
               <f:setPropertyActionListener target="#{pessoaBean.pessoa}" value="#{pessoa}"/><!-- target = para onde vai ser atribuido o valor-->
               <h:graphicImage value="resources/imagens/icon-editar.png"/>                           <!-- value = é o valor que é o objeto da lista de pessoas -->
            </h:commandLink>
         </h:column>

         <h:column rendered="#{pessoaBean.permiteAcesso('ADMINISTRADOR')}"> <!-- rendered = aqui ele está deixando o acesso de excluir apenas para o usuário ADMINISTRADOR-->
            <f:facet name="header">Excluir</f:facet>
            <h:commandLink action="#{pessoaBean.remove}" title="Excluir" immediate="true">
               <f:setPropertyActionListener target="#{pessoaBean.pessoa}" value="#{pessoa}"/>
               <h:graphicImage value="resources/imagens/icon-remover.png" title="Excluir"/>
            </h:commandLink>
         </h:column>
      </b:dataTable>
   </h:form>

</h:body>

</html>
